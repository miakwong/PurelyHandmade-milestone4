<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: 50px auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .btn-admin {
      background-color: #6f42c1;
      color: white;
    }
    .btn-admin:hover {
      background-color: #5a32a3;
      color: white;
    }
  </style>
</head>
<body>
<div class="container">
  <h2 class="mb-4 text-center">Create Admin User</h2>

  <div class="mb-4">
    <h4>Create a New Admin</h4>
    <div class="mb-3">
      <label for="username" class="form-label">Username</label>
      <input type="text" class="form-control" id="username" value="admin">
    </div>
    <div class="mb-3">
      <label for="email" class="form-label">Email</label>
      <input type="email" class="form-control" id="email" value="admin@example.com">
    </div>
    <div class="mb-3">
      <label for="password" class="form-label">Password</label>
      <input type="text" class="form-control" id="password" value="admin123">
    </div>
    <button class="btn btn-admin w-100" id="create-admin">Create Admin User</button>
  </div>

  <hr>

  <div class="mb-4">
    <h4>Existing Users</h4>
    <div id="user-list" class="list-group mb-3">
      <!-- Users will be listed here -->
    </div>
  </div>

  <hr>

  <div class="text-center">
    <a href="/src/views/auth/login.html" class="btn btn-primary">Go to Login Page</a>
  </div>

  <hr>

  <div class="mb-4">
    <h4>Debug Tools</h4>
    <div class="d-grid gap-2">
      <button class="btn btn-info" id="show-localStorage">Show All localStorage Content</button>
      <button class="btn btn-warning" id="clear-users">Clear All User Data</button>
      <button class="btn btn-danger" id="clear-all-data">Clear All Site Data</button>
      <button class="btn btn-success" id="one-click-fix">One-Click Login Fix</button>
    </div>
    <div class="mt-3">
      <textarea id="debug-output" class="form-control" rows="10" readonly style="font-family: monospace; font-size: 12px;"></textarea>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    displayUsers();
    document.getElementById('create-admin').addEventListener('click', function() {
      createAdminUser();
    });
  });

  function displayUsers() {
    const userList = document.getElementById('user-list');
    const users = JSON.parse(localStorage.getItem('users') || '[]');

    if (users.length === 0) {
      userList.innerHTML = '<div class="alert alert-info">No users available</div>';
      return;
    }

    userList.innerHTML = '';
    users.forEach(user => {
      const li = document.createElement('div');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `
          <div>
            <strong>${user.username}</strong>
            <small class="text-muted">${user.email}</small>
            ${user.isAdmin ? '<span class="badge bg-success ms-2">Admin</span>' : ''}
          </div>
          <button class="btn btn-sm btn-danger delete-user" data-id="${user.id}">Delete</button>
        `;
      userList.appendChild(li);
    });

    document.querySelectorAll('.delete-user').forEach(btn => {
      btn.addEventListener('click', function() {
        const userId = parseInt(this.getAttribute('data-id'));
        deleteUser(userId);
      });
    });
  }

  function createAdminUser() {
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    if (!username || !email || !password) {
      alert('Please fill in all fields.');
      return;
    }

    const users = JSON.parse(localStorage.getItem('users') || '[]');

    if (users.some(u => u.username === username || u.email === email)) {
      alert('Username or email already exists.');
      return;
    }

    const newUser = {
      id: Date.now(),
      username: username,
      email: email,
      password: password,
      isAdmin: true,
      createdAt: new Date().toISOString(),
      firstName: "Admin",
      lastName: "User",
      gender: "other",
      birthday: "1990-01-01"
    };

    users.push(newUser);
    localStorage.setItem('users', JSON.stringify(users));
    console.log('New admin user created:', newUser);
    displayUsers();

    alert(`Admin user created successfully!
Username: ${username}
Password: ${password}
Email: ${email}
ID: ${newUser.id}
Is Admin: ${newUser.isAdmin}

You can use either the username or email to log in. Please remember this info.`);

    const loginNow = confirm("Log in as this user now?");
    if (loginNow) {
      localStorage.setItem('currentUser', JSON.stringify({
        id: newUser.id,
        username: newUser.username,
        email: newUser.email,
        isAdmin: newUser.isAdmin
      }));

      localStorage.setItem('isAdmin', 'true');
      localStorage.setItem('user', JSON.stringify({
        id: newUser.id,
        firstName: newUser.firstName,
        lastName: newUser.lastName,
        email: newUser.email,
        gender: newUser.gender,
        birthday: newUser.birthday,
        createdAt: newUser.createdAt,
        password: newUser.password
      }));

      window.location.href = '/src/views/auth/profile.html';
    }
  }

  function deleteUser(userId) {
    if (!confirm('Are you sure you want to delete this user?')) return;

    let users = JSON.parse(localStorage.getItem('users') || '[]');
    users = users.filter(u => u.id !== userId);
    localStorage.setItem('users', JSON.stringify(users));
    displayUsers();
  }

  document.getElementById('show-localStorage').addEventListener('click', function() {
    const debugOutput = document.getElementById('debug-output');
    let output = '';

    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      let value = localStorage.getItem(key);

      try {
        const parsed = JSON.parse(value);
        value = JSON.stringify(parsed, null, 2);
      } catch (e) {}

      output += `KEY: ${key}\nVALUE: ${value}\n\n`;
    }

    if (output === '') {
      output = 'localStorage is empty.';
    }

    debugOutput.value = output;
  });

  document.getElementById('clear-users').addEventListener('click', function() {
    if (confirm('Clear all user data? This will delete all accounts and profiles.')) {
      localStorage.removeItem('users');
      localStorage.removeItem('currentUser');
      localStorage.removeItem('user');
      localStorage.removeItem('isAdmin');
      localStorage.removeItem('usersData');
      alert('All user data has been cleared.');
      displayUsers();
    }
  });

  document.getElementById('clear-all-data').addEventListener('click', function() {
    if (confirm('Clear all site data? This will remove users, orders, comments, etc.')) {
      localStorage.clear();
      alert('All site data has been cleared.');
      displayUsers();
    }
  });

  document.getElementById('one-click-fix').addEventListener('click', function() {
    localStorage.removeItem('users');
    localStorage.removeItem('currentUser');
    localStorage.removeItem('user');
    localStorage.removeItem('isAdmin');

    const adminUser = {
      id: 1,
      username: "admin",
      email: "admin@example.com",
      password: "admin123",
      isAdmin: true,
      createdAt: new Date().toISOString(),
      firstName: "Admin",
      lastName: "User",
      gender: "other",
      birthday: "1990-01-01"
    };

    localStorage.setItem('users', JSON.stringify([adminUser]));
    localStorage.setItem('currentUser', JSON.stringify({
      id: adminUser.id,
      username: adminUser.username,
      email: adminUser.email,
      isAdmin: adminUser.isAdmin
    }));

    localStorage.setItem('isAdmin', 'true');
    localStorage.setItem('user', JSON.stringify({
      id: adminUser.id,
      firstName: adminUser.firstName,
      lastName: adminUser.lastName,
      email: adminUser.email,
      gender: adminUser.gender,
      birthday: adminUser.birthday,
      createdAt: adminUser.createdAt,
      password: adminUser.password
    }));

    localStorage.setItem('usersData', JSON.stringify([
      { id: 1, name: "Admin User", email: "admin@example.com", status: "Active" },
      { id: 2, name: "Test User", email: "test@example.com", status: "Active" }
    ]));

    localStorage.setItem('ordersData', JSON.stringify([
      { id: 101, product: "Handmade Soap", amount: "$50", orderStatus: "New" },
      { id: 102, product: "Handmade Candle", amount: "$30", orderStatus: "Packed" }
    ]));

    localStorage.setItem('commentsData', JSON.stringify([
      { id: 1, author: "Lisa", rating: 5, text: "Excellent product, great quality!" },
      { id: 2, author: "Mike", rating: 4, text: "Beautifully packaged, very thoughtful." }
    ]));

    localStorage.setItem('userAddresses', JSON.stringify([
      {
        id: "addr1",
        name: "Home Address",
        fullName: "Admin User",
        phone: "123-456-7890",
        addressLine1: "123 Main St",
        addressLine2: "Apt 4B",
        city: "Springfield",
        state: "IL",
        zipCode: "62704",
        country: "US",
        isDefault: true
      }
    ]));

    alert(`Admin account successfully created!
          Username: admin
          Password: admin123

          You are now logged in as admin.

          1. Click "Go to Login Page"
          2. Log in using the above credentials, or
          3. Proceed directly to profile page.`);

    if (confirm("Go to profile page now?")) {
      window.location.href = "/src/views/auth/profile.html";
    }

    displayUsers();
  });
</script>
</body>
</html>
