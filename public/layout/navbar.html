<head>
  <!-- Google Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <link rel="stylesheet" href="/~miakuang/PurelyHandmade/css/navbar.css" id="navbar-css">
</head>
<!-- Top Navigation Bar -->
<nav class="navbar navbar-light bg-light p-3">
  <div class="container d-flex justify-content-between">
    <a class="navbar-brand d-flex align-items-center" href="/~miakuang/PurelyHandmade/public/index.html">
      <img src="/~miakuang/PurelyHandmade/server/uploads/images/logo.jpg" alt="Logo" width="50" id="navbar-logo">
      <span class="ms-2 fs-4">Purely Homemade</span>
    </a>

    <!-- Search Bar -->
    <form class="d-flex" action="/~miakuang/PurelyHandmade/public/index.html" method="GET">
      <input class="form-control me-2" type="search" name="search" placeholder="Search products...">
      <button class="btn btn-outline-primary" type="submit">üîç</button>
    </form>

    <!-- Login & Cart -->
    <div class="d-flex align-items-center">
      <!-- User Dropdown Menu -->
      <div class="dropdown me-3">
        <a href="#" class="btn btn-outline-secondary dropdown-toggle" id="userDropdown">
          <i class="material-icons-outlined">account_circle</i>
        </a>
        <ul class="dropdown-menu" aria-labelledby="userDropdown">
          <li><a class="dropdown-item" href="/~miakuang/PurelyHandmade/public/views/auth/login.html"
              id="login-link">Login</a></li>
          <li><a class="dropdown-item" href="/~miakuang/PurelyHandmade/public/views/auth/register.html"
              id="register-link">Register</a></li>
        </ul>
      </div>
      <!-- Cart Icon -->
      <a href="/~miakuang/PurelyHandmade/public/views/checkout/cart.html" class="btn btn-outline-primary"
        id="cart-link">
        <i class="material-icons-outlined">shopping_bag</i>
        <span class="badge bg-danger rounded-pill" id="cart-count" style="display: none;">0</span>
      </a>
    </div>
  </div>
</nav>

<!-- Main Navigation Menu -->
<div class="container-wrapper">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav w-100 d-flex justify-content-around">
          <!-- Navigation items removed, using only the brand link in the top navbar -->
        </ul>
      </div>
    </div>
  </nav>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const userDropdown = document.getElementById('userDropdown');
    const loginLink = document.getElementById('login-link');
    const registerLink = document.getElementById('register-link');
    const cartLink = document.getElementById('cart-link');
    const navbarLogo = document.getElementById('navbar-logo');
    const navbarCss = document.getElementById('navbar-css');

    // get the base URL and API URL from the config object
    const apiUrl = window.config ? window.config.apiUrl : 'https://cosc360.ok.ubc.ca/~miakuang/PurelyHandmade/server/api';
    const baseUrl = window.config ? window.config.baseUrl : 'https://cosc360.ok.ubc.ca/~miakuang/PurelyHandmade';

    // css path
    if (window.config && window.config.production) {
      navbarCss.href = `${baseUrl}/css/navbar.css`;
    }

    // logo path
    if (window.config && window.config.imagesUrl) {
      navbarLogo.src = `${window.config.imagesUrl}/logo.jpg`;
    }

    // check user status
    fetch(`${apiUrl}/auth.php?action=status`)
      .then(response => response.json())
      .then(data => {
        if (data.loggedIn) {
          // user is logged in
          loginLink.parentElement.style.display = 'none';
          registerLink.parentElement.style.display = 'none';

          const profileItem = document.createElement('li');
          profileItem.innerHTML = `<a class="dropdown-item" href="/~miakuang/PurelyHandmade/public/views/auth/profile.html">My Profile</a>`;

          const logoutItem = document.createElement('li');
          logoutItem.innerHTML = `<a class="dropdown-item" href="#" id="logout-link">Logout</a>`;

          // if the user is an admin, add the admin panel link
          if (data.isAdmin) {
            const adminItem = document.createElement('li');
            adminItem.innerHTML = `<a class="dropdown-item" href="/~miakuang/PurelyHandmade/public/views/admin/dashboard.html">Admin Panel</a>`;
            loginLink.parentElement.parentElement.appendChild(adminItem);
          }

          loginLink.parentElement.parentElement.appendChild(profileItem);
          loginLink.parentElement.parentElement.appendChild(logoutItem);

          //logout
          document.getElementById('logout-link').addEventListener('click', function (e) {
            e.preventDefault();
            fetch(`${apiUrl}/auth.php?action=logout`)
              .then(response => response.json())
              .then(() => {
                window.location.reload();
              });
          });
        }
      })
      .catch(error => {
        console.error('Error checking authentication status:', error);
      });

    // boostrap dropdown initialization
    if (typeof bootstrap !== 'undefined') {
      const dropdown = new bootstrap.Dropdown(userDropdown);
    }
  });
</script>