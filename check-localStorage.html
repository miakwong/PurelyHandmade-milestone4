<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>localStorage Diagnostic Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    pre {
      background-color: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      max-height: 300px;
      overflow: auto;
    }
    .result-box {
      margin-top: 20px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
<div class="container my-5">
  <h1>localStorage Diagnostic Tool</h1>
  <p>Use this tool to inspect your localStorage status and resolve product display issues.</p>

  <div class="card mb-4">
    <div class="card-header">
      <h4>Check Admin Status</h4>
    </div>
    <div class="card-body">
      <p>Current Admin Status: <span id="admin-status" class="badge bg-secondary">Checking...</span></p>
      <button id="set-admin-true" class="btn btn-success">Set as Admin</button>
      <button id="set-admin-false" class="btn btn-secondary">Remove Admin</button>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header">
      <h4>Check Product Data</h4>
    </div>
    <div class="card-body">
      <p>Number of Products: <span id="product-count" class="badge bg-secondary">Checking...</span></p>
      <div class="result-box">
        <h5>Product Data:</h5>
        <pre id="products-data">Checking...</pre>
      </div>
      <button id="init-test-products" class="btn btn-primary">Initialize Test Products</button>
      <button id="clear-products" class="btn btn-danger">Clear Product Data</button>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header">
      <h4>Check Designer Data</h4>
    </div>
    <div class="card-body">
      <p>Number of Designers: <span id="designer-count" class="badge bg-secondary">Checking...</span></p>
      <div class="result-box">
        <h5>Designer Data:</h5>
        <pre id="designers-data">Checking...</pre>
      </div>
      <button id="init-test-designers" class="btn btn-primary">Initialize Test Designers</button>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header">
      <h4>Check Category Data</h4>
    </div>
    <div class="card-body">
      <p>Number of Categories: <span id="category-count" class="badge bg-secondary">Checking...</span></p>
      <div class="result-box">
        <h5>Category Data:</h5>
        <pre id="categories-data">Checking...</pre>
      </div>
      <button id="init-test-categories" class="btn btn-primary">Initialize Test Categories</button>
    </div>
  </div>

  <div class="alert alert-info">
    <h4>Instructions:</h4>
    <ol>
      <li>Click "Set as Admin" to enable admin access</li>
      <li>Check if product data exists; if not, click "Initialize Test Products"</li>
      <li>Ensure category data is present; if not, click "Initialize Test Categories"</li>
      <li>When done, return to the <a href="src/views/auth/profile.html" class="alert-link">User Profile Page</a> and refresh</li>
    </ol>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    checkAdminStatus();
    checkProductsData();
    checkDesignersData();
    checkCategoriesData();
    setupEventListeners();
  });

  function checkAdminStatus() {
    const isAdmin = localStorage.getItem('isAdmin') === 'true';
    const statusEl = document.getElementById('admin-status');
    statusEl.textContent = isAdmin ? 'Enabled' : 'Disabled';
    statusEl.className = `badge ${isAdmin ? 'bg-success' : 'bg-danger'}`;
  }

  function checkProductsData() {
    const products = JSON.parse(localStorage.getItem('products') || '[]');
    const countEl = document.getElementById('product-count');
    const dataEl = document.getElementById('products-data');

    countEl.textContent = products.length;
    countEl.className = `badge ${products.length > 0 ? 'bg-success' : 'bg-danger'}`;
    dataEl.textContent = products.length > 0
            ? JSON.stringify(products, null, 2).substring(0, 1000) + (JSON.stringify(products, null, 2).length > 1000 ? '...' : '')
            : 'No product data';
  }

  function checkDesignersData() {
    const designers = JSON.parse(localStorage.getItem('designers') || '[]');
    const countEl = document.getElementById('designer-count');
    const dataEl = document.getElementById('designers-data');

    countEl.textContent = designers.length;
    countEl.className = `badge ${designers.length > 0 ? 'bg-success' : 'bg-danger'}`;
    dataEl.textContent = designers.length > 0
            ? JSON.stringify(designers, null, 2)
            : 'No designer data';
  }

  function checkCategoriesData() {
    const categories = JSON.parse(localStorage.getItem('categories') || '[]');
    const countEl = document.getElementById('category-count');
    const dataEl = document.getElementById('categories-data');

    countEl.textContent = categories.length;
    countEl.className = `badge ${categories.length > 0 ? 'bg-success' : 'bg-danger'}`;
    dataEl.textContent = categories.length > 0
            ? JSON.stringify(categories, null, 2)
            : 'No category data';
  }

  function setupEventListeners() {
    document.getElementById('set-admin-true').addEventListener('click', function () {
      localStorage.setItem('isAdmin', 'true');
      checkAdminStatus();
    });

    document.getElementById('set-admin-false').addEventListener('click', function () {
      localStorage.setItem('isAdmin', 'false');
      checkAdminStatus();
    });

    document.getElementById('init-test-products').addEventListener('click', function () {
      initTestProducts();
      checkProductsData();
    });

    document.getElementById('clear-products').addEventListener('click', function () {
      if (confirm('Are you sure you want to clear all product data?')) {
        localStorage.setItem('products', '[]');
        checkProductsData();
      }
    });

    document.getElementById('init-test-designers').addEventListener('click', function () {
      initTestDesigners();
      checkDesignersData();
    });

    document.getElementById('init-test-categories').addEventListener('click', function () {
      initTestCategories();
      checkCategoriesData();
    });
  }

  function initTestProducts() {
    const testProducts = [
      {
        id: 1,
        name: "Handcrafted Ceramic Vase",
        categoryId: 1,
        price: 49.99,
        stock: 15,
        description: "A handmade ceramic vase with a minimalist style, perfect for various spaces.",
        details: "Height: 20cm, Diameter: 10cm<br>Material: Premium ceramic<br>Style: Modern minimalist<br>Usage: Living room, dining room, study",
        onSale: false,
        salePrice: null,
        images: ["../../assets/img/product1.jpg", "../../assets/img/product1-2.jpg"],
        listingDate: new Date().toISOString(),
        reviews: []
      },
      {
        id: 2,
        name: "Woven Storage Basket",
        categoryId: 2,
        price: 35.99,
        stock: 8,
        description: "Eco-friendly and durable handmade basket made from natural materials.",
        details: "Diameter: 30cm, Height: 15cm<br>Material: Natural rattan<br>Usage: Storage, decoration, picnic<br>Features: Sustainable, durable, natural",
        onSale: true,
        salePrice: 29.99,
        images: ["../../assets/img/product2.jpg"],
        listingDate: new Date().toISOString(),
        reviews: [
          {
            name: "Alex",
            rating: 5,
            comment: "Excellent quality, very satisfied!",
            date: new Date().toISOString()
          }
        ]
      },
      {
        id: 3,
        name: "Wool Handwoven Blanket",
        categoryId: 3,
        price: 89.99,
        stock: 5,
        description: "Soft and cozy blanket made from premium handwoven wool.",
        details: "Size: 150cm x 200cm<br>Material: High-quality wool<br>Features: Soft, warm, breathable<br>Usage: Sofa, bed, camping",
        onSale: false,
        salePrice: null,
        images: ["../../assets/img/product3.jpg"],
        listingDate: new Date().toISOString(),
        reviews: []
      }
    ];

    localStorage.setItem('products', JSON.stringify(testProducts));
    alert('Successfully initialized 3 test products!');
  }

  function initTestDesigners() {
    const testDesigners = [
      {
        id: "d1",
        name: "Emma Chen",
        specialty: "Ceramic Arts",
        bio: "A senior ceramic artist with 15 years of experience, featured in multiple international exhibitions.",
        image: "../../assets/img/designer1.jpg",
        images: ["../../assets/img/designer1.jpg"],
        social: {
          instagram: "https://instagram.com/emma_chen",
          pinterest: "https://pinterest.com/emma_chen",
          etsy: "https://etsy.com/shop/emma_chen"
        }
      },
      {
        id: "d2",
        name: "Daniel Wu",
        specialty: "Handweaving",
        bio: "Focused on natural material weaving, blending traditional craft with modern design.",
        image: "../../assets/img/designer2.jpg",
        images: ["../../assets/img/designer2.jpg"],
        social: {
          instagram: "https://instagram.com/danielweaves",
          pinterest: "",
          etsy: "https://etsy.com/shop/danielweaves"
        }
      }
    ];

    localStorage.setItem('designers', JSON.stringify(testDesigners));
    alert('Successfully initialized 2 test designers!');
  }

  function initTestCategories() {
    const testCategories = [
      {
        id: 1,
        name: "Ceramics",
        description: "A variety of handmade ceramic items including vases, tableware, and decorations.",
        image: "../../assets/img/category1.jpg"
      },
      {
        id: 2,
        name: "Woodcraft",
        description: "Finely crafted wooden goods including furniture, decor, and useful tools.",
        image: "../../assets/img/category2.jpg"
      },
      {
        id: 3,
        name: "Textiles",
        description: "Handwoven textile items including blankets, cushions, and curtains.",
        image: "../../assets/img/category3.jpg"
      }
    ];

    localStorage.setItem('categories', JSON.stringify(testCategories));
    alert('Successfully initialized 3 test categories!');
  }
</script>
</body>
</html>
